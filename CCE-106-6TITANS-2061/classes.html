<!DOCTYPE html>
<html lang="en">
  <head>
    <link rel="stylesheet" href="assets/css/profile.css" />
    <style>
      #authButtons {
        visibility: hidden;
      }
    </style>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Class Schedules - 6Titans</title>
    <link rel="stylesheet" href="assets/css/styles-base.css" />
    <link rel="stylesheet" href="assets/css/classes.css" />
    <link rel="stylesheet" href="assets/css/auth-nav.css" />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
      rel="stylesheet"
    />
  </head>
  <body>
    <!-- Navigation -->
    <nav class="navbar">
      <div class="nav-container">
        <div class="nav-logo">
          <img src="images/image 66.png" alt="6Titans Logo" class="logo-icon" />
          <img src="images/image 67.png" alt="6Titans" class="logo-text" />
        </div>
        <ul class="nav-menu">
          <li class="nav-item">
            <a href="index.html" class="nav-link">Home</a>
          </li>
          <li class="nav-item">
            <a href="membership.html" class="nav-link">Membership</a>
          </li>
          <li class="nav-item">
            <a href="classes.html" class="nav-link active">Classes</a>
          </li>
          <li class="nav-item">
            <a href="workouts.html" class="nav-link">Workouts</a>
          </li>
          <li class="nav-item">
            <a href="coaching.html" class="nav-link">Coaching</a>
          </li>
          <li class="nav-item">
            <a href="online-gym.html" class="nav-link">Appointments</a>
          </li>
          <li class="nav-item">
            <a href="articles.html" class="nav-link">Articles</a>
          </li>
        </ul>
        <div class="auth-buttons" id="authButtons">
          <a href="login.html" id="loginBtnNav">Login</a>
          <a href="register.html" id="signupBtnNav">Sign Up</a>
        </div>
        <div class="hamburger">
          <span class="bar"></span>
          <span class="bar"></span>
          <span class="bar"></span>
        </div>
      </div>
    </nav>

    <!-- Class Schedules Section -->
    <section class="class-schedules">
      <div class="container">
        <h1 class="page-title">Class Schedules</h1>

        <!-- Day Filters -->
        <div class="day-filters">
          <button class="filter-btn active" data-day="all">All days</button>
          <button class="filter-btn" data-day="monday">Monday</button>
          <button class="filter-btn" data-day="tuesday">Tuesday</button>
          <button class="filter-btn" data-day="wednesday">Wednesday</button>
          <button class="filter-btn" data-day="thursday">Thursday</button>
          <button class="filter-btn" data-day="friday">Friday</button>
          <button class="filter-btn" data-day="weekend">Week-End</button>
        </div>

        <!-- Class Cards (dynamic) -->
        <div class="classes-grid" id="classesGrid"></div>
      </div>
    </section>

    <!-- Booking Modal -->
    <div id="bookingModal" class="modal">
      <div class="modal-content">
        <span class="close">&times;</span>
        <h2>Book Class</h2>
        <form id="bookingForm">
          <div class="form-group">
            <label for="className">Class Name</label>
            <input type="text" id="className" name="className" readonly />
          </div>
          <div class="form-group">
            <label for="classTime">Time</label>
            <input type="text" id="classTime" name="classTime" readonly />
          </div>
          <div class="form-group">
            <label for="instructor">Instructor</label>
            <input type="text" id="instructor" name="instructor" readonly />
          </div>
          <div class="form-group">
            <label for="memberName">Your Name *</label>
            <input type="text" id="memberName" name="memberName" required />
          </div>
          <div class="form-group">
            <label for="memberEmail">Email *</label>
            <input type="email" id="memberEmail" name="memberEmail" required />
          </div>
          <div class="form-group">
            <label for="memberPhone">Phone Number *</label>
            <input type="tel" id="memberPhone" name="memberPhone" required />
          </div>
          <button type="submit" class="btn btn-primary">Confirm Booking</button>
        </form>
      </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
      <div class="container">
        <div class="footer-content">
          <div class="footer-section">
            <div class="footer-logo">
              <img
                src="images/image 66.png"
                alt="6Titans Logo"
                class="logo-icon"
              />
              <img src="images/image 67.png" alt="6Titans" class="logo-text" />
            </div>
            <p>Transform your body, transform your life.</p>
          </div>
          <div class="footer-section">
            <h4>Quick Links</h4>
            <ul>
              <li><a href="index.html">Home</a></li>
              <li><a href="membership.html">Membership</a></li>
              <li><a href="classes.html">Classes</a></li>
              <li><a href="workouts.html">Workouts</a></li>
            </ul>
          </div>
          <div class="footer-section">
            <h4>Support</h4>
            <ul>
              <li><a href="#">Help Center</a></li>
              <li><a href="#">Contact Us</a></li>
              <li><a href="#">Privacy Policy</a></li>
              <li><a href="#">Terms of Service</a></li>
            </ul>
          </div>
          <div class="footer-section">
            <h4>Follow Us</h4>
            <div class="social-links">
              <a href="#"><i class="fab fa-facebook"></i></a>
              <a href="#"><i class="fab fa-instagram"></i></a>
              <a href="#"><i class="fab fa-twitter"></i></a>
              <a href="#"><i class="fab fa-youtube"></i></a>
            </div>
          </div>
        </div>
        <div class="footer-bottom">
          <p>&copy; 2024 6Titans. All rights reserved.</p>
        </div>
      </div>
    </footer>

    <script src="script.js"></script>
    <script src="utils.js"></script>
    <script src="classes.js"></script>
    
    <!-- Load classes from Firebase RTDB -->
    <script type="module">
      import { ref, onValue } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-database.js";
      import { rtdb } from "./firebase-init.js";
      
      const grid = document.getElementById("classesGrid");
      
      function render(classes) {
        const days = [
          "monday",
          "tuesday",
          "wednesday",
          "thursday",
          "friday",
          "weekend",
        ];
        const cards = Object.values(classes || {})
          .map((c) => {
            const day = (c.day || "monday").toLowerCase();
            const safeDay = days.includes(day) ? day : "monday";
            const name = c.name || "Class";
            const time = c.time || "";
            const instructor = c.instructor || "";
            const desc = c.description || "";
            return `
          <div class="class-card" data-day="${safeDay}">
            <div class="class-header">
              <h3 class="class-name">${name}</h3>
              <div class="class-time">${time}</div>
            </div>
            <p class="class-description">${desc}</p>
            <div class="class-details">
              <div class="class-detail">
                <i class="fas fa-user"></i>
                <span>${instructor}</span>
              </div>
              <div class="class-detail">
                <i class="fas fa-clock"></i>
                <span>${time || "60min"}</span>
              </div>
            </div>
            <button class="btn btn-primary book-class">Book Class</button>
          </div>`;
          })
          .join("");
        grid.innerHTML = cards || '<p style="color:#ccc">No classes yet.</p>';
      }
      
      onValue(ref(rtdb, "classes"), (snap) => {
        render(snap.val());
      });
    </script>
    
    <!-- Initialize auth UI -->
    <script type="module">
      import { ref, get, child, set, push } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-database.js";
      import { auth, rtdb } from "./firebase-init.js";
      import { initAuthState } from "./auth-ui.js";
      
      // Expose to classes.js
      window.firebaseAuth = auth;
      window.firebaseRtdb = rtdb;
      window.firebaseRT = { ref, get, child, set, push };
      
      // Initialize auth state with membership gating callback
      initAuthState(async (userData) => {
        try {
          if (!userData || !userData.membership || userData.membership.status !== "active") {
            const container = document.querySelector(".class-schedules .container");
            const banner = document.createElement("div");
            banner.style.background = "#1a1a1a";
            banner.style.border = "1px solid #333";
            banner.style.borderLeft = "4px solid #ff6b6b";
            banner.style.color = "#fff";
            banner.style.padding = "12px 16px";
            banner.style.borderRadius = "8px";
            banner.style.margin = "1rem 0";
            banner.innerHTML = `Booking classes requires an active membership. <a href="membership.html" style="color:#ffd700;text-decoration:underline">Upgrade now</a>`;
            if (container)
              container.insertBefore(banner, container.children[2] || null);
          }
        } catch {}
      });
    </script>
    <script type="module">
      // Initialize role guard to protect against pending coaches
      import { initRoleGuard } from "./role-guard.js";
      initRoleGuard({ requireAuth: false }); // Public page but check for pending coaches
    </script>
    <script src="script.js"></script>
  </body>
</html>
